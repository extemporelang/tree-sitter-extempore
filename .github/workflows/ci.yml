name: CI

on:
  push:
    branches: [main]
  pull_request:
    branches: [main]

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - uses: actions/setup-node@v4
        with:
          node-version: "24"

      - run: npm ci

      - name: Generate parser
        run: npx tree-sitter generate

      - name: Run tests
        run: npx tree-sitter test

      - name: Parse sample file
        run: |
          cat > /tmp/sample.xtm << 'EOF'
          (bind-func add:[i64,i64,i64]*
            (lambda (a b)
              (+ a b)))

          (bind-type Point <!a,!a>)

          (define (square x) (* x x))

          ;; a comment
          #| block comment |#
          (println "hello world")
          EOF
          npx tree-sitter parse /tmp/sample.xtm
